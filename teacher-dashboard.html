<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard - STEM Village</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/learning/gamified6-12/css/teacher-analytics.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/learning/gamified6-12/js/teacher-analytics.js"></script>
    <script src="/learning/gamified6-12/js/csv-exporter.js"></script>
    <script src="/learning/gamified6-12/js/adaptive-difficulty-tracker.js"></script>
</head>
<body class="bg-gray-100">
    <!-- Sidebar -->
    <div class="flex h-screen overflow-hidden">
        <div class="hidden md:flex md:flex-shrink-0">
            <div class="flex flex-col w-64 bg-green-700 text-white">
                <div class="flex items-center justify-center h-16 px-4 bg-green-800">
                    <img src="/static/logo-white.png" alt="STEM Village" class="h-10">
                </div>
                <div class="flex flex-col flex-grow px-4 py-4 overflow-y-auto">
                    <div class="flex items-center px-4 py-3 mb-2 rounded-lg bg-green-800">
                        <img class="w-10 h-10 rounded-full" src="http://static.photos/people/200x200/6" alt="Teacher">
                        <div class="ml-3">
                            <p class="font-medium">Priya Sharma</p>
                            <p class="text-sm text-green-200">Math Teacher</p>
                        </div>
                    </div>
                    
                    <nav class="flex-1 space-y-2">
                        <a href="#" class="flex items-center px-4 py-3 text-white bg-green-800 rounded-lg">
                            <i data-feather="home" class="w-5 h-5"></i>
                            <span class="ml-3">Dashboard</span>
                        </a>
                        <a href="/teacher-classes.html" class="flex items-center px-4 py-3 text-green-200 hover:text-white hover:bg-green-800 rounded-lg transition duration-300">
                            <i data-feather="users" class="w-5 h-5"></i>
                            <span class="ml-3">My Classes</span>
                        </a>
                        <a href="/teacher-progress.html" class="flex items-center px-4 py-3 text-green-200 hover:text-white hover:bg-green-800 rounded-lg transition duration-300">
                            <i data-feather="bar-chart-2" class="w-5 h-5"></i>
                            <span class="ml-3">Progress Reports</span>
                        </a>
                        <a href="/teacher-assignments.html" class="flex items-center px-4 py-3 text-green-200 hover:text-white hover:bg-green-800 rounded-lg transition duration-300">
                            <i data-feather="book" class="w-5 h-5"></i>
                            <span class="ml-3">Assignments</span>
                        </a>
                        <a href="/teacher-resources.html" class="flex items-center px-4 py-3 text-green-200 hover:text-white hover:bg-green-800 rounded-lg transition duration-300">
                            <i data-feather="folder" class="w-5 h-5"></i>
                            <span class="ml-3">Resources</span>
                        </a>
                    </nav>
                    
                    <div class="mt-auto pb-4">
                        <a href="/teacher-settings.html" class="flex items-center px-4 py-3 text-green-200 hover:text-white hover:bg-green-800 rounded-lg transition duration-300">
                            <i data-feather="settings" class="w-5 h-5"></i>
                            <span class="ml-3">Settings</span>
                        </a>
                        <a href="/logout.html" class="flex items-center px-4 py-3 text-green-200 hover:text-white hover:bg-green-800 rounded-lg transition duration-300">
                            <i data-feather="log-out" class="w-5 h-5"></i>
                            <span class="ml-3">Logout</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="flex flex-col flex-1 overflow-hidden">
            <!-- Mobile Header -->
            <div class="md:hidden flex items-center justify-between px-4 py-3 bg-green-700 text-white">
                <button class="text-white focus:outline-none">
                    <i data-feather="menu" class="w-6 h-6"></i>
                </button>
                <img src="/static/logo-white.png" alt="STEM Village" class="h-8">
                <div class="w-6"></div>
            </div>
            
            <!-- Main Content Area -->
            <div class="flex-1 overflow-auto p-4 md:p-6">
                <div class="max-w-7xl mx-auto">
                    <!-- Enhanced Analytics Header -->
                    <div class="bg-gradient-to-r from-green-600 to-green-800 rounded-xl p-6 text-white mb-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                        <div>
                            <h1 class="text-2xl font-bold mb-2" data-i18n="analytics.dashboard">Analytics Dashboard</h1>
                            <p class="text-green-100" data-i18n="analytics.help.analytics">View detailed analytics and reports for your class.</p>
                        </div>
                        <div class="flex flex-wrap gap-2 items-center">
                            <select id="class-filter" class="rounded px-3 py-2 text-gray-800">
                                <option value="all">All Classes</option>
                                <option value="8A">Grade 8A</option>
                                <option value="8B">Grade 8B</option>
                            </select>
                            <select id="date-range" class="rounded px-3 py-2 text-gray-800">
                                <option value="7">Last 7 days</option>
                                <option value="30">Last 30 days</option>
                                <option value="90">Last 3 months</option>
                            </select>
                            <button class="export-btn flex items-center" id="export-csv-btn"><i data-feather="download" class="w-4 h-4 mr-1"></i><span data-i18n="analytics.exportCSV">Export to CSV</span></button>
                        </div>
                    </div>
                    <!-- Analytics Charts Section -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="analytics-card">
                            <h2 class="font-bold mb-2" data-i18n="analytics.performanceTrends">Performance Trends</h2>
                            <div class="chart-container"><canvas id="performance-trend-chart"></canvas></div>
                        </div>
                        <div class="analytics-card">
                            <h2 class="font-bold mb-2" data-i18n="analytics.subjectComparison">Subject Comparison</h2>
                            <div class="chart-container"><canvas id="subject-comparison-chart"></canvas></div>
                        </div>
                        <div class="analytics-card">
                            <h2 class="font-bold mb-2" data-i18n="analytics.engagementLevels">Engagement Levels</h2>
                            <div class="chart-container"><canvas id="engagement-heatmap"></canvas></div>
                        </div>
                        <div class="analytics-card">
                            <h2 class="font-bold mb-2" data-i18n="analytics.difficultyProgression">Difficulty Progression</h2>
                            <div class="chart-container"><canvas id="difficulty-progression-chart"></canvas></div>
                        </div>
                    </div>
                    <!-- Class-wise Progress Visualization -->
                    <div class="class-comparison mb-6">
                        <div class="class-comparison-card">
                            <h3 class="font-bold mb-2" data-i18n="analytics.classOverview">Class Overview</h3>
                            <div id="class-overview"></div>
                        </div>
                        <div class="class-comparison-card">
                            <h3 class="font-bold mb-2" data-i18n="analytics.studentAnalytics">Student Analytics</h3>
                            <div id="student-analytics"></div>
                        </div>
                        <div class="class-comparison-card">
                            <h3 class="font-bold mb-2" data-i18n="analytics.subjectComparison">Subject Mastery</h3>
                            <div id="subject-mastery"></div>
                        </div>
                    </div>
                    <!-- Weak Topic Identification Dashboard -->
                    <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                        <h2 class="text-xl font-bold mb-4" data-i18n="analytics.weakTopics">Weak Topics</h2>
                        <div id="weak-topics-list"></div>
                    </div>
                    <!-- Enhanced Recent Activity Table -->
                    <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold" data-i18n="analytics.recentActivity">Recent Student Activity</h2>
                            <a href="/teacher-progress.html" class="text-green-600 hover:text-green-800 text-sm font-medium">View All</a>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="data-table min-w-full">
                                <thead>
                                    <tr>
                                        <th data-i18n="analytics.studentList">Student</th>
                                        <th data-i18n="analytics.activityHistory">Activity</th>
                                        <th data-i18n="analytics.subjectComparison">Subject</th>
                                        <th data-i18n="analytics.scoreDistribution">Score</th>
                                        <th data-i18n="analytics.timeSpent">Time</th>
                                        <th data-i18n="analytics.difficultyAdjustment">Difficulty</th>
                                        <th data-i18n="analytics.action">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="activity-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                    <!-- CSV Export Interface -->
                    <div class="export-controls mb-6">
                        <label><input type="checkbox" checked> <span data-i18n="analytics.studentProgress">Student Progress</span></label>
                        <label><input type="checkbox" checked> <span data-i18n="analytics.classOverview">Class Overview</span></label>
                        <label><input type="checkbox"> <span data-i18n="analytics.weakTopics">Weak Topics</span></label>
                        <label><input type="checkbox"> <span data-i18n="analytics.engagementLevels">Engagement</span></label>
                        <label><input type="checkbox"> <span data-i18n="analytics.difficultyProgression">Difficulty</span></label>
                        <button class="export-btn" id="custom-export-btn"><i data-feather="download" class="w-4 h-4 mr-1"></i><span data-i18n="analytics.generateReport">Generate Report</span></button>
                    </div>
                    
                    <!-- Quick Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <!-- Class Performance -->
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-lg font-bold">Class Performance</h2>
                                <div class="text-green-600 bg-green-100 px-2 py-1 rounded-full text-xs font-medium">+12%</div>
                            </div>
                            <div class="h-40">
                                <!-- Chart placeholder -->
                                <div class="flex items-end h-32 space-x-1">
                                    <div class="w-1/5 bg-green-200 h-16 rounded-t"></div>
                                    <div class="w-1/5 bg-green-300 h-20 rounded-t"></div>
                                    <div class="w-1/5 bg-green-400 h-24 rounded-t"></div>
                                    <div class="w-1/5 bg-green-500 h-28 rounded-t"></div>
                                    <div class="w-1/5 bg-green-600 h-32 rounded-t"></div>
                                </div>
                            </div>
                            <p class="text-sm text-gray-600 mt-2">Average score improvement this month</p>
                        </div>
                        
                        <!-- Active Students -->
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-lg font-bold">Active Students</h2>
                                <div class="text-blue-600 bg-blue-100 px-2 py-1 rounded-full text-xs font-medium">38/48</div>
                            </div>
                            <div class="flex items-center justify-center h-32">
                                <div class="relative w-24 h-24">
                                    <svg class="w-full h-full" viewBox="0 0 36 36">
                                        <path d="M18 2.0845
                                            a 15.9155 15.9155 0 0 1 0 31.831
                                            a 15.9155 15.9155 0 0 1 0 -31.831"
                                            fill="none"
                                            stroke="#e6e6e6"
                                            stroke-width="3"
                                            stroke-dasharray="100, 100"
                                        />
                                        <path d="M18 2.0845
                                            a 15.9155 15.9155 0 0 1 0 31.831
                                            a 15.9155 15.9155 0 0 1 0 -31.831"
                                            fill="none"
                                            stroke="#3b82f6"
                                            stroke-width="3"
                                            stroke-dasharray="79, 100"
                                        />
                                    </svg>
                                    <div class="absolute inset-0 flex items-center justify-center">
                                        <span class="text-2xl font-bold">79%</span>
                                    </div>
                                </div>
                            </div>
                            <p class="text-sm text-gray-600 mt-2">Active in the last 7 days</p>
                        </div>
                        
                        <!-- Assignments Due -->
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-lg font-bold">Assignments Due</h2>
                                <div class="text-red-600 bg-red-100 px-2 py-1 rounded-full text-xs font-medium">3</div>
                            </div>
                            <div class="space-y-4 h-32 overflow-y-auto">
                                <div class="flex items-start">
                                    <div class="bg-green-100 p-2 rounded-lg mr-3">
                                        <i data-feather="book" class="w-4 h-4 text-green-600"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium text-sm">Algebra Quiz</p>
                                        <p class="text-xs text-gray-600">Due tomorrow</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <div class="bg-blue-100 p-2 rounded-lg mr-3">
                                        <i data-feather="edit" class="w-4 h-4 text-blue-600"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium text-sm">Science Project</p>
                                        <p class="text-xs text-gray-600">Due in 3 days</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <div class="bg-purple-100 p-2 rounded-lg mr-3">
                                        <i data-feather="code" class="w-4 h-4 text-purple-600"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium text-sm">Coding Challenge</p>
                                        <p class="text-xs text-gray-600">Due in 5 days</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Activity -->
                    <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold">Recent Student Activity</h2>
                            <a href="/teacher-progress.html" class="text-green-600 hover:text-green-800 text-sm font-medium">View All</a>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Activity</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subject</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="flex-shrink-0 h-10 w-10">
                                                    <img class="h-10 w-10 rounded-full" src="http://static.photos/people/200x200/7" alt="">
                                                </div>
                                                <div class="ml-4">
                                                    <div class="text-sm font-medium text-gray-900">Rahul Kumar</div>
                                                    <div class="text-sm text-gray-500">Grade 8A</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm text-gray-900">Algebra Quiz</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">Math</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            <div class="flex items-center">
                                                <div class="w-full bg-gray-200 rounded-full h-2 mr-2">
                                                    <div class="bg-green-600 h-2 rounded-full" style="width: 85%"></div>
                                                </div>
                                                <span>85%</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            2 hours ago
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="flex-shrink-0 h-10 w-10">
                                                    <img class="h-10 w-10 rounded-full" src="http://static.photos/people/200x200/8" alt="">
                                                </div>
                                                <div class="ml-4">
                                                    <div class="text-sm font-medium text-gray-900">Priya Patel</div>
                                                    <div class="text-sm text-gray-500">Grade 8B</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm text-gray-900">Chemical Reactions</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Science</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            <div class="flex items-center">
                                                <div class="w-full bg-gray-200 rounded-full h-2 mr-2">
                                                    <div class="bg-green-600 h-2 rounded-full" style="width: 92%"></div>
                                                </div>
                                                <span>92%</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            5 hours ago
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="flex-shrink-0 h-10 w-10">
                                                    <img class="h-10 w-10 rounded-full" src="http://static.photos/people/200x200/9" alt="">
                                                </div>
                                                <div class="ml-4">
                                                    <div class="text-sm font-medium text-gray-900">Amit Singh</div>
                                                    <div class="text-sm text-gray-500">Grade 8A</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm text-gray-900">Python Basics</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800">Technology</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            <div class="flex items-center">
                                                <div class="w-full bg-gray-200 rounded-full h-2 mr-2">
                                                    <div class="bg-green-600 h-2 rounded-full" style="width: 78%"></div>
                                                </div>
                                                <span>78%</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            1 day ago
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Your Classes -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold">Your Classes</h2>
                            <a href="/teacher-classes.html" class="text-green-600 hover:text-green-800 text-sm font-medium">View All</a>
                        </div>
                        
                        <div class="grid md:grid-cols-3 gap-4">
                            <!-- Class 1 -->
                            <div class="border border-gray-200 rounded-lg overflow-hidden hover:shadow-md transition duration-300">
                                <div class="h-32 bg-blue-100 flex items-center justify-center">
                                    <i data-feather="book" class="w-10 h-10 text-blue-600"></i>
                                </div>
                                <div class="p-4">
                                    <h3 class="font-bold mb-1">Grade 8A - Mathematics</h3>
                                    <p class="text-sm text-gray-600 mb-3">24 students</p>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center text-sm text-gray-600">
                                            <i data-feather="activity" class="w-4 h-4 mr-1 text-green-600"></i>
                                            <span>78% avg</span>
                                        </div>
                                        <a href="#" class="text-sm text-blue-600 hover:text-blue-800">View Class</a>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Class 2 -->
                            <div class="border border-gray-200 rounded-lg overflow-hidden hover:shadow-md transition duration-300">
                                <div class="h-32 bg-green-100 flex items-center justify-center">
                                    <i data-feather="flask" class="w-10 h-10 text-green-600"></i>
                                </div>
                                <div class="p-4">
                                    <h3 class="font-bold mb-1">Grade 8B - Science</h3>
                                    <p class="text-sm text-gray-600 mb-3">22 students</p>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center text-sm text-gray-600">
                                            <i data-feather="activity" class="w-4 h-4 mr-1 text-green-600"></i>
                                            <span>82% avg</span>
                                        </div>
                                        <a href="#" class="text-sm text-blue-600 hover:text-blue-800">View Class</a>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Class 3 -->
                            <div class="border border-gray-200 rounded-lg overflow-hidden hover:shadow-md transition duration-300">
                                <div class="h-32 bg-purple-100 flex items-center justify-center">
                                    <i data-feather="plus" class="w-10 h-10 text-purple-600"></i>
                                </div>
                                <div class="p-4 flex items-center justify-center h-full">
                                    <button class="text-purple-600 hover:text-purple-800 font-medium">
                                        <i data-feather="plus" class="w-5 h-5 mr-2"></i>
                                        Add New Class
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        feather.replace();
        i18n.init();
        // Analytics dashboard JS init
        document.addEventListener('DOMContentLoaded', async function() {
            await TeacherAnalytics.init();
            // Example: render dummy charts (replace with real data wiring)
            const ctx1 = document.getElementById('performance-trend-chart').getContext('2d');
            new Chart(ctx1, { type: 'line', data: { labels: ['Week 1','Week 2','Week 3','Week 4'], datasets: [{ label: 'Avg Score', data: [65, 72, 78, 85], borderColor: '#10b981', fill: false }] }, options: { responsive: true } });
            const ctx2 = document.getElementById('subject-comparison-chart').getContext('2d');
            new Chart(ctx2, { type: 'bar', data: { labels: ['Math','Science','Physics','Chemistry','Tech'], datasets: [{ label: 'Avg', data: [82, 79, 75, 80, 70], backgroundColor: ['#10b981','#3b82f6','#f59e42','#a78bfa','#f43f5e'] }] }, options: { indexAxis: 'y', responsive: true } });
            const ctx3 = document.getElementById('engagement-heatmap').getContext('2d');
            new Chart(ctx3, { type: 'bar', data: { labels: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'], datasets: [{ label: 'Active Students', data: [38, 40, 35, 42, 39, 37, 36], backgroundColor: '#059669' }] }, options: { responsive: true } });
            const ctx4 = document.getElementById('difficulty-progression-chart').getContext('2d');
            new Chart(ctx4, { type: 'line', data: { labels: ['Week 1','Week 2','Week 3','Week 4'], datasets: [{ label: 'Difficulty', data: [2, 2.5, 3, 3.5], borderColor: '#f59e42', fill: false }] }, options: { responsive: true } });
            // TODO: Wire up TeacherAnalytics, CSVExporter, AdaptiveDifficultyTracker, and fill all widgets/tables
        });
    </script>
</body>
</html>